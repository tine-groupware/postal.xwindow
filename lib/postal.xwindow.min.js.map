{"version":3,"sources":["postal.xwindow.js"],"names":["root","factory","exports","module","require","define","amd","this","__WEBPACK_EXTERNAL_MODULE_1__","__WEBPACK_EXTERNAL_MODULE_2__","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","_","postal","utils","S","state","env","XWindowClient","getInstance","target","options","instanceId","fedx","transports","xwindow","eagerSerialize","useEagerSerialize","remotes","configure","cfg","config","defaults","extend","clearConfiguration","disconnect","clients","reduce","isArray","_memoRemoteByInstanceId","_memoRemoteByTarget","doNotNotify","each","_disconnectClient","without","apply","concat","getTargets","tidyStorage","sendMessage","envelope","safeSerialize","cloneDeep","remote","wrapForTransport","packingSlip","JSON","stringify","unwrapFromTransport","msgData","indexOf","parse","ex","routeMessage","event","parsed","newValue","find","x","store","namespace","localStoragePrefix","origin","get","push","url","parseUri","protocol","authority","onMessage","signalReady","targets","callback","that","on","bind","keepAlive","length","def","targetId","sendPing","set","Date","getTime","targetTimeout","tidyRemotes","delay","Math","round","targetIds","getAll","memo","targetData","split","now","clear","isEmpty","proxy","tgt","client","json","key","value","str","o","parser","strictMode","exec","uri","i","q","name","replace","$0","$1","$2","strict","loose","location","host","isWorker","window","postMessage","test","navigator","userAgent","allowedOrigins","enabled","workers","FederationClient","arguments","prototype","create","constructor","transportName","shouldProcess","hasDomainFilters","contains","send","msg"],"mappings":"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","file":"postal.xwindow.min.js","sourcesContent":["/*!\n *  * postal.xwindow - postal.js/postal.federation plugin for federating instances of postal.js across unrelated window boundaries.\n *  * Author: Cornelius Wei√ü (http://www.metaways.de)\n *  * Version: v0.0.4\n *  * Url: http://github.com/tine20/postal.xwindow\n *  * License(s): (MIT OR GPL-2.0)\n */\n(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"lodash\"), require(\"postal\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"lodash\", \"postal\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"postalXWindow\"] = factory(require(\"lodash\"), require(\"postal\"));\n\telse\n\t\troot[\"postalXWindow\"] = factory(root[\"_\"], root[\"postal\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_1__, __WEBPACK_EXTERNAL_MODULE_2__) {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar _ = __webpack_require__( 1 );\n\tvar postal = __webpack_require__( 2 );\n\tvar utils = __webpack_require__( 3 );\n\tvar S = __webpack_require__( 4 );\n\tvar state = S.state;\n\tvar env = S.env;\n\tvar XWindowClient = __webpack_require__( 5 );\n\t\n\tXWindowClient.getInstance = function( target, options, instanceId ) {\n\t\treturn new XWindowClient( target, options, instanceId );\n\t};\n\t\n\tpostal.fedx.transports.xwindow = {\n\t\teagerSerialize: env.useEagerSerialize,\n\t\tremotes: [],\n\t\tXWindowClient: XWindowClient,\n\t\tconfigure: function( cfg ) {\n\t\t\tif ( cfg ) {\n\t\t\t\tstate.config = _.defaults( _.extend( state.config, cfg ), state.defaults );\n\t\t\t}\n\t\t\treturn state.config;\n\t\t},\n\t\tclearConfiguration: function() {\n\t\t\tstate.config = _.extend( {}, state.defaults );\n\t\t},\n\t\tdisconnect: function( options ) {\n\t\t\toptions = options || {};\n\t\t\tvar clients = options.instanceId ?\n\t\t\t// an instanceId value or array was provided, let's get the client proxy instances for the id(s)\n\t\t\t_.reduce( _.isArray( options.instanceId ) ? options.instanceId : [ options.instanceId ], utils._memoRemoteByInstanceId, [], this ) :\n\t\t\t// Ok so we don't have instanceId(s), let's try target(s)\n\t\t\toptions.target ?\n\t\t\t// Ok, so we have a targets array, we need to iterate over it and get a list of the proxy/client instances\n\t\t\t_.reduce( _.isArray( options.target ) ? options.target : [ options.target ], utils._memoRemoteByTarget, [], this ) :\n\t\t\t// aww, heck - we don't have instanceId(s) or target(s), so it's ALL THE REMOTES\n\t\t\tthis.remotes;\n\t\t\tif ( !options.doNotNotify ) {\n\t\t\t\t_.each( clients, utils._disconnectClient, this );\n\t\t\t}\n\t\t\tthis.remotes = _.without.apply( null, [ this.remotes ].concat( clients ) );\n\t\t},\n\t\tgetTargets: function() {\n\t\t\treturn this.tidyStorage();\n\t\t},\n\t\tsendMessage: function( env ) {\n\t\t\tvar envelope = env;\n\t\t\tif ( state.config.safeSerialize ) {\n\t\t\t\tenvelope = utils.safeSerialize( _.cloneDeep( env ) );\n\t\t\t}\n\t\t\tvar instanceId = postal.instanceId();\n\t\n\t\t\t_.each( this.remotes, function( remote ) {\n\t\t\t\tif ( remote.instanceId != instanceId ) {\n\t\t\t\t\tremote.sendMessage( envelope );\n\t\t\t\t}\n\t\t\t} );\n\t\t},\n\t\twrapForTransport: env.useEagerSerialize ? function( packingSlip ) {\n\t\t\treturn JSON.stringify( {\n\t\t\t\tpostal: true,\n\t\t\t\tpackingSlip: packingSlip\n\t\t\t} );\n\t\t} : function( packingSlip ) {\n\t\t\treturn {\n\t\t\t\tpostal: true,\n\t\t\t\tpackingSlip: packingSlip\n\t\t\t};\n\t\t},\n\t\tunwrapFromTransport: function( msgData ) {\n\t\t\tif ( typeof msgData === \"string\" && ( env.useEagerSerialize || msgData.indexOf( '\"postal\":true' ) !== -1 ) ) {\n\t\t\t\ttry {\n\t\t\t\t\treturn JSON.parse( msgData );\n\t\t\t\t} catch ( ex ) {\n\t\t\t\t\treturn {};\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn msgData;\n\t\t\t}\n\t\t},\n\t\trouteMessage: function( event ) {\n\t\t\tvar parsed = this.unwrapFromTransport( event.newValue );\n\t\n\t\t\tif ( parsed && parsed.postal ) {\n\t\t\t\tvar packingSlip = parsed.packingSlip;\n\t\t\t\tvar instanceId = packingSlip.instanceId;\n\t\t\t\tif ( packingSlip && instanceId != postal.instanceId() ) {\n\t\t\t\t\tvar remote = _.find( this.remotes, function( x ) {\n\t\t\t\t\t\treturn x.instanceId === instanceId;\n\t\t\t\t\t} );\n\t\t\t\t\tif ( !remote ) {\n\t\t\t\t\t\tvar target = store.namespace( state.config.localStoragePrefix + \".\" + instanceId );\n\t\t\t\t\t\tremote = XWindowClient.getInstance( target, { origin: target.get( \"targetUrl\" ) }, instanceId );\n\t\t\t\t\t\tthis.remotes.push( remote );\n\t\t\t\t\t}\n\t\n\t\t\t\t\t// origin forgery protection\n\t\t\t\t\tvar url = utils.parseUri( event.url );\n\t\t\t\t\tvar origin = url.protocol + \"://\" + url.authority;\n\t\n\t\t\t\t\tif ( remote.options.origin == origin ) {\n\t\t\t\t\t\tremote.onMessage( packingSlip );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tsignalReady: function( targets, callback ) {\n\t\t\tvar instanceId = postal.instanceId();\n\t\t\tvar that = this;\n\t\n\t\t\tthis.target = store.namespace( state.config.localStoragePrefix + \".\" + instanceId );\n\t\t\tthis.target.on( \"message\", _.bind( this.routeMessage, this ) );\n\t\t\tthis.keepAlive();\n\t\n\t\t\ttargets = _.isArray( targets ) ? targets : [ targets ];\n\t\t\ttargets = targets.length ? targets : this.getTargets();\n\t\t\tcallback = callback || function() {};\n\t\n\t\t\t_.each( targets, function( def ) {\n\t\t\t\tif ( def.targetId != instanceId ) {\n\t\t\t\t\tvar remote = _.find( that.remotes, function( x ) {\n\t\t\t\t\t\treturn x.instanceId === def.targetId;\n\t\t\t\t\t} );\n\t\t\t\t\tif ( !remote ) {\n\t\t\t\t\t\tremote = XWindowClient.getInstance( def.target, { origin: def.origin }, def.targetId );\n\t\t\t\t\t\tthat.remotes.push( remote );\n\t\t\t\t\t}\n\t\t\t\t\tremote.sendPing( callback );\n\t\t\t\t}\n\t\t\t}, this );\n\t\t},\n\t\tkeepAlive: function() {\n\t\t\tthis.target.set( \"targetUrl\", env.origin );\n\t\t\tthis.target.set( \"targetTimeout\", new Date().getTime() + state.config.targetTimeout );\n\t\n\t\t\tthis.tidyStorage();\n\t\t\tthis.tidyRemotes();\n\t\n\t\t\t_.delay( _.bind( this.keepAlive, this ), Math.round( state.config.targetTimeout / 2 ) );\n\t\t},\n\t\ttidyStorage: function() {\n\t\t\tvar targetIds = _.reduce( store.namespace( state.config.localStoragePrefix ).getAll(), function( memo, targetData, id ) {\n\t\t\t\tvar targetId = id.split( \".\" )[0];\n\t\t\t\tif ( _.indexOf( memo, targetId ) < 0 ) {\n\t\t\t\t\tmemo.push( targetId );\n\t\t\t\t}\n\t\t\t\treturn memo;\n\t\t\t}, [] );\n\t\n\t\t\tvar now = new Date().getTime();\n\t\t\treturn _.reduce( targetIds, function( memo, targetId ) {\n\t\t\t\tvar target = store.namespace( state.config.localStoragePrefix + \".\" + targetId );\n\t\t\t\tif ( target.get( \"targetTimeout\" ) < now ) {\n\t\t\t\t\ttarget.clear();\n\t\t\t\t} else {\n\t\t\t\t\tmemo.push( {\n\t\t\t\t\t\ttargetId: targetId,\n\t\t\t\t\t\ttarget: target,\n\t\t\t\t\t\torigin: target.get( \"targetUrl\" )\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t\treturn memo;\n\t\t\t}, [] );\n\t\t},\n\t\ttidyRemotes: function() {\n\t\t\tvar that = this;\n\t\t\t_.each( this.remotes, function( remote ) {\n\t\t\t\tif ( _.isEmpty( remote.target.getAll() ) ) {\n\t\t\t\t\tthat.disconnect( { target: remote.target } );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t};\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\tmodule.exports = __WEBPACK_EXTERNAL_MODULE_1__;\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\tmodule.exports = __WEBPACK_EXTERNAL_MODULE_2__;\n\n/***/ },\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar _ = __webpack_require__( 1 );\n\t\n\tvar _memoRemoteByInstanceId = function( memo, instanceId ) {\n\t\tvar proxy = _.find( this.remotes, function( x ) {\n\t\t\treturn x.instanceId === instanceId;\n\t\t} );\n\t\tif ( proxy ) {\n\t\t\tmemo.push( proxy );\n\t\t}\n\t\treturn memo;\n\t};\n\t\n\tvar _memoRemoteByTarget = function( memo, tgt ) {\n\t\tvar proxy = _.find( this.remotes, function( x ) {\n\t\t\treturn x.target === tgt;\n\t\t} );\n\t\tif ( proxy ) {\n\t\t\tmemo.push( proxy );\n\t\t}\n\t\treturn memo;\n\t};\n\t\n\tvar _disconnectClient = function( client ) {\n\t\tclient.disconnect();\n\t};\n\t\n\tsafeSerialize = function safeSerialize( envelope ) {\n\t\tvar json = JSON.parse( JSON.stringify( envelope, function( key, value ) {\n\t\t\tif ( typeof value === \"function\" ) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\treturn value;\n\t\t} ) );\n\t\n\t\treturn json;\n\t};\n\t\n\t// parseUri 1.2.2\n\t// (c) Steven Levithan <stevenlevithan.com>\n\t// MIT License\n\t\n\tvar parseUri = function( str ) {\n\t\tvar o = parseUri.options;\n\t\tvar m = o.parser[o.strictMode ? \"strict\" : \"loose\"].exec( str );\n\t\tvar uri = {};\n\t\tvar i = 14;\n\t\n\t\twhile ( i-- ) {\n\t\t\turi[o.key[i]] = m[i] || \"\";\n\t\t}\n\t\n\t\turi[o.q.name] = {};\n\t\turi[o.key[12]].replace( o.q.parser, function( $0, $1, $2 ) {\n\t\t\tif ( $1 ) {\n\t\t\t\turi[o.q.name][$1] = $2;\n\t\t\t}\n\t\t} );\n\t\n\t\treturn uri;\n\t};\n\t\n\tparseUri.options = {\n\t\tstrictMode: false,\n\t\tkey: [ \"source\",\"protocol\",\"authority\",\"userInfo\",\"user\",\"password\",\"host\",\"port\",\"relative\",\"path\",\"directory\",\"file\",\"query\",\"anchor\" ],\n\t\tq: {\n\t\t\tname: \"queryKey\",\n\t\t\tparser: /(?:^|&)([^&=]*)=?([^&]*)/g\n\t\t},\n\t\tparser: {\n\t\t\tstrict: /^(?:([^:\\/?#]+):)?(?:\\/\\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?))?((((?:[^?#\\/]*\\/)*)([^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,\n\t\t\tloose: /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/\n\t\t}\n\t};\n\t\n\tmodule.exports = {\n\t\t_memoRemoteByInstanceId: _memoRemoteByInstanceId,\n\t\t_memoRemoteByTarget: _memoRemoteByTarget,\n\t\t_disconnectClient: _disconnectClient,\n\t\tsafeSerialize: safeSerialize,\n\t\tparseUri: parseUri\n\t};\n\n\n/***/ },\n/* 4 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar _ = __webpack_require__( 1 );\n\t\n\tvar env = {\n\t\torigin: location.origin || location.protocol + \"//\" + location.host,\n\t\tisWorker: ( typeof window === \"undefined\" ) && postMessage && location,\n\t\t// I know, I KNOW. The alternative was very expensive perf & time-wise\n\t\t// so I saved you a perf hit by checking the stinking UA. Sigh.\n\t\t// I sought the opinion of several other devs. We all traveled\n\t\t// to the far east to consult with the wisdom of a monk - turns\n\t\t// out he didn\"t know JavaScript, and our passports were stolen on the\n\t\t// return trip. We stowed away aboard a freighter headed back to the\n\t\t// US and by the time we got back, no one had heard of IE 8 or 9. True story.\n\t\tuseEagerSerialize: /MSIE [8,9]/.test( navigator.userAgent )\n\t};\n\t\n\tvar defaults = {\n\t\tallowedOrigins: [ env.origin ],\n\t\tenabled: true,\n\t\tsafeSerialize: false,\n\t\tlocalStoragePrefix: \"postal.fedx.xwindow\",\n\t\ttargetTimeout: 60000 // 1 minute\n\t};\n\t\n\tvar state = {\n\t\tworkers: [],\n\t\tconfig: _.extend( {}, defaults ),\n\t\tdefaults: defaults\n\t};\n\t\n\tmodule.exports = {\n\t\tstate: state,\n\t\tenv: env\n\t};\n\n\n/***/ },\n/* 5 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar _ = __webpack_require__( 1 );\n\tvar postal = __webpack_require__( 2 );\n\tvar S = __webpack_require__( 4 );\n\tvar state = S.state;\n\tvar env = S.env;\n\t\n\tvar XWindowClient = function() {\n\t\tpostal.fedx.FederationClient.apply( this, arguments );\n\t};\n\t\n\tXWindowClient.prototype = _.create( postal.fedx.FederationClient.prototype, {\n\t\tconstructor: XWindowClient,\n\t\n\t\ttransportName: \"xwindow\",\n\t\n\t\tshouldProcess: function() {\n\t\t\tvar hasDomainFilters = !!state.config.allowedOrigins.length;\n\t\t\treturn state.config.enabled &&\n\t\t\t\t\t// another frame/window\n\t\t\t\t( ( this.options.origin === \"*\" || ( hasDomainFilters && _.contains( state.config.allowedOrigins, this.options.origin ) || !hasDomainFilters ) ) ||\n\t\t\t\t\t// worker\n\t\t\t\t( this.options.isWorker && _.contains( state.workers, this.target ) ) ||\n\t\t\t\t\t// we are in a worker\n\t\t\t\tenv.isWorker );\n\t\t},\n\t\tsend: function( packingSlip ) {\n\t\t\tif ( this.shouldProcess() ) {\n\t\t\t\tvar msg = postal.fedx.transports.xwindow.wrapForTransport( packingSlip );\n\t\t\t\tthis.target.set( \"message\", msg );\n\t\t\t}\n\t\t}\n\t} );\n\t\n\tmodule.exports = XWindowClient;\n\n\n/***/ }\n/******/ ])\n});\n;"],"sourceRoot":"/source/"}