{"version":3,"sources":["postal.xwindow.js"],"names":["root","factory","exports","module","require","define","amd","this","__WEBPACK_EXTERNAL_MODULE_1__","__WEBPACK_EXTERNAL_MODULE_2__","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","_","postal","utils","S","state","env","XWindowClient","getInstance","target","options","instanceId","fedx","transports","xwindow","eagerSerialize","useEagerSerialize","remotes","configure","cfg","config","defaults","extend","clearConfiguration","disconnect","clients","reduce","isArray","bind","_memoRemoteByInstanceId","_memoRemoteByTarget","doNotNotify","forEach","_disconnectClient","without","apply","concat","getTargets","tidyStorage","sendMessage","envelope","safeSerialize","cloneDeep","remote","wrapForTransport","packingSlip","JSON","stringify","unwrapFromTransport","msgData","indexOf","parse","ex","routeMessage","event","parsed","newValue","find","x","store","namespace","localStoragePrefix","origin","get","push","url","parseUri","protocol","authority","onMessage","signalReady","targets","callback","that","on","keepAlive","length","def","targetId","sendPing","set","Date","getTime","targetTimeout","tidyRemotes","delay","Math","round","targetIds","getAll","memo","targetData","split","now","clear","isEmpty","proxy","tgt","client","json","key","value","str","o","parser","strictMode","exec","uri","i","q","name","replace","$0","$1","$2","strict","loose","location","host","isWorker","window","postMessage","test","navigator","userAgent","allowedOrigins","enabled","workers","src","log","error","console","isIE","attachEvent","addEventListener","execScript","eval","FederationClient","arguments","prototype","create","constructor","transportName","shouldProcess","hasDomainFilters","includes","send","msg"],"mappings":"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","file":"postal.xwindow.min.js","sourcesContent":["/*!\n *  * postal.xwindow - postal.js/postal.federation plugin for federating instances of postal.js across unrelated window boundaries.\n *  * Author: Cornelius Wei√ü (http://www.metaways.de)\n *  * Version: v0.0.8\n *  * Url: http://github.com/tine20/postal.xwindow\n *  * License(s): (MIT OR GPL-2.0)\n */\n(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"lodash\"), require(\"postal\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"lodash\", \"postal\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"postalXWindow\"] = factory(require(\"lodash\"), require(\"postal\"));\n\telse\n\t\troot[\"postalXWindow\"] = factory(root[\"_\"], root[\"postal\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_1__, __WEBPACK_EXTERNAL_MODULE_2__) {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tvar _ = __webpack_require__( 1 );\n\tvar postal = __webpack_require__( 2 );\n\tvar utils = __webpack_require__( 3 );\n\tvar S = __webpack_require__( 4 );\n\tvar state = S.state;\n\tvar env = S.env;\n\t__webpack_require__( 5 );\n\t__webpack_require__( 8 );\n\tvar XWindowClient = __webpack_require__( 10 );\n\t\n\tXWindowClient.getInstance = function( target, options, instanceId ) {\n\t\treturn new XWindowClient( target, options, instanceId );\n\t};\n\t\n\tpostal.fedx.transports.xwindow = {\n\t\teagerSerialize: env.useEagerSerialize,\n\t\tremotes: [],\n\t\tXWindowClient: XWindowClient,\n\t\tconfigure: function( cfg ) {\n\t\t\tif ( cfg ) {\n\t\t\t\tstate.config = _.defaults( _.extend( state.config, cfg ), state.defaults );\n\t\t\t}\n\t\t\treturn state.config;\n\t\t},\n\t\tclearConfiguration: function() {\n\t\t\tstate.config = _.extend( {}, state.defaults );\n\t\t},\n\t\tdisconnect: function( options ) {\n\t\t\toptions = options || {};\n\t\t\tvar clients = options.instanceId ?\n\t\t\t// an instanceId value or array was provided, let's get the client proxy instances for the id(s)\n\t\t\t_.reduce( _.isArray( options.instanceId ) ? options.instanceId : [ options.instanceId ], _.bind( utils._memoRemoteByInstanceId, this ), [] ) :\n\t\t\t// Ok so we don't have instanceId(s), let's try target(s)\n\t\t\toptions.target ?\n\t\t\t// Ok, so we have a targets array, we need to iterate over it and get a list of the proxy/client instances\n\t\t\t_.reduce( _.isArray( options.target ) ? options.target : [ options.target ], _.bind( utils._memoRemoteByTarget, this ), [] ) :\n\t\t\t// aww, heck - we don't have instanceId(s) or target(s), so it's ALL THE REMOTES\n\t\t\tthis.remotes;\n\t\t\tif ( !options.doNotNotify ) {\n\t\t\t\t_.forEach( clients, _.bind( utils._disconnectClient, this ) );\n\t\t\t}\n\t\t\tthis.remotes = _.without.apply( null, [ this.remotes ].concat( clients ) );\n\t\t},\n\t\tgetTargets: function() {\n\t\t\treturn this.tidyStorage();\n\t\t},\n\t\tsendMessage: function( env ) {\n\t\t\tvar envelope = env;\n\t\t\tif ( state.config.safeSerialize ) {\n\t\t\t\tenvelope = utils.safeSerialize( _.cloneDeep( env ) );\n\t\t\t}\n\t\t\tvar instanceId = postal.instanceId();\n\t\n\t\t\t_.forEach( this.remotes, function( remote ) {\n\t\t\t\tif ( remote.instanceId != instanceId ) {\n\t\t\t\t\tremote.sendMessage( envelope );\n\t\t\t\t}\n\t\t\t} );\n\t\t},\n\t\twrapForTransport: env.useEagerSerialize ? function( packingSlip ) {\n\t\t\treturn JSON.stringify( {\n\t\t\t\tpostal: true,\n\t\t\t\tpackingSlip: packingSlip\n\t\t\t} );\n\t\t} : function( packingSlip ) {\n\t\t\treturn {\n\t\t\t\tpostal: true,\n\t\t\t\tpackingSlip: packingSlip\n\t\t\t};\n\t\t},\n\t\tunwrapFromTransport: function( msgData ) {\n\t\t\tif ( typeof msgData === \"string\" && ( env.useEagerSerialize || msgData.indexOf( '\"postal\":true' ) !== -1 ) ) {\n\t\t\t\ttry {\n\t\t\t\t\treturn JSON.parse( msgData );\n\t\t\t\t} catch ( ex ) {\n\t\t\t\t\treturn {};\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn msgData;\n\t\t\t}\n\t\t},\n\t\trouteMessage: function( event ) {\n\t\t\tvar parsed = this.unwrapFromTransport( event.newValue );\n\t\n\t\t\tif ( parsed && parsed.postal ) {\n\t\t\t\tvar packingSlip = parsed.packingSlip;\n\t\t\t\tvar instanceId = packingSlip.instanceId;\n\t\t\t\tif ( packingSlip && instanceId != postal.instanceId() ) {\n\t\t\t\t\tvar remote = _.find( this.remotes, function( x ) {\n\t\t\t\t\t\treturn x.instanceId === instanceId;\n\t\t\t\t\t} );\n\t\t\t\t\tif ( !remote ) {\n\t\t\t\t\t\tvar target = store.namespace( state.config.localStoragePrefix + \".\" + instanceId );\n\t\t\t\t\t\tremote = XWindowClient.getInstance( target, { origin: target.get( \"targetUrl\" ) }, instanceId );\n\t\t\t\t\t\tthis.remotes.push( remote );\n\t\t\t\t\t}\n\t\n\t\t\t\t\t// origin forgery protection\n\t\t\t\t\tvar url = utils.parseUri( event.url );\n\t\t\t\t\tvar origin = url.protocol + \"://\" + url.authority;\n\t\n\t\t\t\t\tif ( remote.options.origin == origin ) {\n\t\t\t\t\t\tremote.onMessage( packingSlip );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tsignalReady: function( targets, callback ) {\n\t\t\tvar instanceId = postal.instanceId();\n\t\t\tvar that = this;\n\t\n\t\t\tthis.target = store.namespace( state.config.localStoragePrefix + \".\" + instanceId );\n\t\t\tthis.target.on( \"message\", _.bind( this.routeMessage, this ) );\n\t\t\tthis.keepAlive();\n\t\n\t\t\ttargets = _.isArray( targets ) ? targets : [ targets ];\n\t\t\ttargets = targets.length ? targets : this.getTargets();\n\t\t\tcallback = callback || function() {};\n\t\n\t\t\t_.forEach( targets, _.bind( function( def ) {\n\t\t\t\tif ( def.targetId != instanceId ) {\n\t\t\t\t\tvar remote = _.find( that.remotes, function( x ) {\n\t\t\t\t\t\treturn x.instanceId === def.targetId;\n\t\t\t\t\t} );\n\t\t\t\t\tif ( !remote ) {\n\t\t\t\t\t\tremote = XWindowClient.getInstance( def.target, { origin: def.origin }, def.targetId );\n\t\t\t\t\t\tthat.remotes.push( remote );\n\t\t\t\t\t}\n\t\t\t\t\tremote.sendPing( callback );\n\t\t\t\t}\n\t\t\t}, this ) );\n\t\t},\n\t\tkeepAlive: function() {\n\t\t\tthis.target.set( \"targetUrl\", env.origin );\n\t\t\tthis.target.set( \"targetTimeout\", new Date().getTime() + state.config.targetTimeout );\n\t\n\t\t\tthis.tidyStorage();\n\t\t\tthis.tidyRemotes();\n\t\n\t\t\t_.delay( _.bind( this.keepAlive, this ), Math.round( state.config.targetTimeout / 2 ) );\n\t\t},\n\t\ttidyStorage: function() {\n\t\t\tvar targetIds = _.reduce( store.namespace( state.config.localStoragePrefix ).getAll(), function( memo, targetData, id ) {\n\t\t\t\tvar targetId = id.split( \".\" )[0];\n\t\t\t\tif ( _.indexOf( memo, targetId ) < 0 ) {\n\t\t\t\t\tmemo.push( targetId );\n\t\t\t\t}\n\t\t\t\treturn memo;\n\t\t\t}, [] );\n\t\n\t\t\tvar now = new Date().getTime();\n\t\t\treturn _.reduce( targetIds, function( memo, targetId ) {\n\t\t\t\tvar target = store.namespace( state.config.localStoragePrefix + \".\" + targetId );\n\t\t\t\tif ( target.get( \"targetTimeout\" ) < now ) {\n\t\t\t\t\ttarget.clear();\n\t\t\t\t} else {\n\t\t\t\t\tmemo.push( {\n\t\t\t\t\t\ttargetId: targetId,\n\t\t\t\t\t\ttarget: target,\n\t\t\t\t\t\torigin: target.get( \"targetUrl\" )\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t\treturn memo;\n\t\t\t}, [] );\n\t\t},\n\t\ttidyRemotes: function() {\n\t\t\tvar that = this;\n\t\t\t_.forEach( this.remotes, function( remote ) {\n\t\t\t\tif ( _.isEmpty( remote.target.getAll() ) ) {\n\t\t\t\t\tthat.disconnect( { target: remote.target } );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t};\n\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports) {\n\n\tmodule.exports = __WEBPACK_EXTERNAL_MODULE_1__;\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports) {\n\n\tmodule.exports = __WEBPACK_EXTERNAL_MODULE_2__;\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tvar _ = __webpack_require__( 1 );\n\t\n\tvar _memoRemoteByInstanceId = function( memo, instanceId ) {\n\t\tvar proxy = _.find( this.remotes, function( x ) {\n\t\t\treturn x.instanceId === instanceId;\n\t\t} );\n\t\tif ( proxy ) {\n\t\t\tmemo.push( proxy );\n\t\t}\n\t\treturn memo;\n\t};\n\t\n\tvar _memoRemoteByTarget = function( memo, tgt ) {\n\t\tvar proxy = _.find( this.remotes, function( x ) {\n\t\t\treturn x.target === tgt;\n\t\t} );\n\t\tif ( proxy ) {\n\t\t\tmemo.push( proxy );\n\t\t}\n\t\treturn memo;\n\t};\n\t\n\tvar _disconnectClient = function( client ) {\n\t\tclient.disconnect();\n\t};\n\t\n\tsafeSerialize = function safeSerialize( envelope ) {\n\t\tvar json = JSON.parse( JSON.stringify( envelope, function( key, value ) {\n\t\t\tif ( typeof value === \"function\" ) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\treturn value;\n\t\t} ) );\n\t\n\t\treturn json;\n\t};\n\t\n\t// parseUri 1.2.2\n\t// (c) Steven Levithan <stevenlevithan.com>\n\t// MIT License\n\t\n\tvar parseUri = function( str ) {\n\t\tvar o = parseUri.options;\n\t\tvar m = o.parser[o.strictMode ? \"strict\" : \"loose\"].exec( str );\n\t\tvar uri = {};\n\t\tvar i = 14;\n\t\n\t\twhile ( i-- ) {\n\t\t\turi[o.key[i]] = m[i] || \"\";\n\t\t}\n\t\n\t\turi[o.q.name] = {};\n\t\turi[o.key[12]].replace( o.q.parser, function( $0, $1, $2 ) {\n\t\t\tif ( $1 ) {\n\t\t\t\turi[o.q.name][$1] = $2;\n\t\t\t}\n\t\t} );\n\t\n\t\treturn uri;\n\t};\n\t\n\tparseUri.options = {\n\t\tstrictMode: false,\n\t\tkey: [ \"source\",\"protocol\",\"authority\",\"userInfo\",\"user\",\"password\",\"host\",\"port\",\"relative\",\"path\",\"directory\",\"file\",\"query\",\"anchor\" ],\n\t\tq: {\n\t\t\tname: \"queryKey\",\n\t\t\tparser: /(?:^|&)([^&=]*)=?([^&]*)/g\n\t\t},\n\t\tparser: {\n\t\t\tstrict: /^(?:([^:\\/?#]+):)?(?:\\/\\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?))?((((?:[^?#\\/]*\\/)*)([^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,\n\t\t\tloose: /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/\n\t\t}\n\t};\n\t\n\tmodule.exports = {\n\t\t_memoRemoteByInstanceId: _memoRemoteByInstanceId,\n\t\t_memoRemoteByTarget: _memoRemoteByTarget,\n\t\t_disconnectClient: _disconnectClient,\n\t\tsafeSerialize: safeSerialize,\n\t\tparseUri: parseUri\n\t};\n\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tvar _ = __webpack_require__( 1 );\n\t\n\tvar env = {\n\t\torigin: location.origin || location.protocol + \"//\" + location.host,\n\t\tisWorker: ( typeof window === \"undefined\" ) && postMessage && location,\n\t\t// I know, I KNOW. The alternative was very expensive perf & time-wise\n\t\t// so I saved you a perf hit by checking the stinking UA. Sigh.\n\t\t// I sought the opinion of several other devs. We all traveled\n\t\t// to the far east to consult with the wisdom of a monk - turns\n\t\t// out he didn\"t know JavaScript, and our passports were stolen on the\n\t\t// return trip. We stowed away aboard a freighter headed back to the\n\t\t// US and by the time we got back, no one had heard of IE 8 or 9. True story.\n\t\tuseEagerSerialize: /MSIE [8,9]/.test( navigator.userAgent )\n\t};\n\t\n\tvar defaults = {\n\t\tallowedOrigins: [ env.origin ],\n\t\tenabled: true,\n\t\tsafeSerialize: false,\n\t\tlocalStoragePrefix: \"postal.fedx.xwindow\",\n\t\ttargetTimeout: 60000 // 1 minute\n\t};\n\t\n\tvar state = {\n\t\tworkers: [],\n\t\tconfig: _.extend( {}, defaults ),\n\t\tdefaults: defaults\n\t};\n\t\n\tmodule.exports = {\n\t\tstate: state,\n\t\tenv: env\n\t};\n\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t__webpack_require__(6)(__webpack_require__(7))\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports) {\n\n\t/*\n\t\tMIT License http://www.opensource.org/licenses/mit-license.php\n\t\tAuthor Tobias Koppers @sokra\n\t*/\n\tmodule.exports = function(src) {\n\t\tfunction log(error) {\n\t\t\t(typeof console !== \"undefined\")\n\t\t\t&& (console.error || console.log)(\"[Script Loader]\", error);\n\t\t}\n\t\n\t\t// Check for IE =< 8\n\t\tfunction isIE() {\n\t\t\treturn typeof attachEvent !== \"undefined\" && typeof addEventListener === \"undefined\";\n\t\t}\n\t\n\t\ttry {\n\t\t\tif (typeof execScript !== \"undefined\" && isIE()) {\n\t\t\t\texecScript(src);\n\t\t\t} else if (typeof eval !== \"undefined\") {\n\t\t\t\teval.call(null, src);\n\t\t\t} else {\n\t\t\t\tlog(\"EvalError: No eval function available\");\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tlog(error);\n\t\t}\n\t}\n\n\n/***/ }),\n/* 7 */\n/***/ (function(module, exports) {\n\n\tmodule.exports = \"/*! store2 - v2.5.11 - 2018-01-18\\n* Copyright (c) 2018 Nathan Bubna; Licensed (MIT OR GPL-3.0) */\\n;(function(window, define) {\\n    var _ = {\\n        version: \\\"2.5.11\\\",\\n        areas: {},\\n        apis: {},\\n\\n        // utilities\\n        inherit: function(api, o) {\\n            for (var p in api) {\\n                if (!o.hasOwnProperty(p)) {\\n                    o[p] = api[p];\\n                }\\n            }\\n            return o;\\n        },\\n        stringify: function(d) {\\n            return d === undefined || typeof d === \\\"function\\\" ? d+'' : JSON.stringify(d);\\n        },\\n        parse: function(s) {\\n            // if it doesn't parse, return as is\\n            try{ return JSON.parse(s); }catch(e){ return s; }\\n        },\\n\\n        // extension hooks\\n        fn: function(name, fn) {\\n            _.storeAPI[name] = fn;\\n            for (var api in _.apis) {\\n                _.apis[api][name] = fn;\\n            }\\n        },\\n        get: function(area, key){ return area.getItem(key); },\\n        set: function(area, key, string){ area.setItem(key, string); },\\n        remove: function(area, key){ area.removeItem(key); },\\n        key: function(area, i){ return area.key(i); },\\n        length: function(area){ return area.length; },\\n        clear: function(area){ area.clear(); },\\n\\n        // core functions\\n        Store: function(id, area, namespace) {\\n            var store = _.inherit(_.storeAPI, function(key, data, overwrite) {\\n                if (arguments.length === 0){ return store.getAll(); }\\n                if (typeof data === \\\"function\\\"){ return store.transact(key, data, overwrite); }// fn=data, alt=overwrite\\n                if (data !== undefined){ return store.set(key, data, overwrite); }\\n                if (typeof key === \\\"string\\\" || typeof key === \\\"number\\\"){ return store.get(key); }\\n                if (!key){ return store.clear(); }\\n                return store.setAll(key, data);// overwrite=data, data=key\\n            });\\n            store._id = id;\\n            try {\\n                var testKey = '_safariPrivate_';\\n                area.setItem(testKey, 'sucks');\\n                store._area = area;\\n                area.removeItem(testKey);\\n            } catch (e) {}\\n            if (!store._area) {\\n                store._area = _.inherit(_.storageAPI, { items: {}, name: 'fake' });\\n            }\\n            store._ns = namespace || '';\\n            if (!_.areas[id]) {\\n                _.areas[id] = store._area;\\n            }\\n            if (!_.apis[store._ns+store._id]) {\\n                _.apis[store._ns+store._id] = store;\\n            }\\n            return store;\\n        },\\n        storeAPI: {\\n            // admin functions\\n            area: function(id, area) {\\n                var store = this[id];\\n                if (!store || !store.area) {\\n                    store = _.Store(id, area, this._ns);//new area-specific api in this namespace\\n                    if (!this[id]){ this[id] = store; }\\n                }\\n                return store;\\n            },\\n            namespace: function(namespace, noSession) {\\n                if (!namespace){\\n                    return this._ns ? this._ns.substring(0,this._ns.length-1) : '';\\n                }\\n                var ns = namespace, store = this[ns];\\n                if (!store || !store.namespace) {\\n                    store = _.Store(this._id, this._area, this._ns+ns+'.');//new namespaced api\\n                    if (!this[ns]){ this[ns] = store; }\\n                    if (!noSession){ store.area('session', _.areas.session); }\\n                }\\n                return store;\\n            },\\n            isFake: function(){ return this._area.name === 'fake'; },\\n            toString: function() {\\n                return 'store'+(this._ns?'.'+this.namespace():'')+'['+this._id+']';\\n            },\\n\\n            // storage functions\\n            has: function(key) {\\n                if (this._area.has) {\\n                    return this._area.has(this._in(key));//extension hook\\n                }\\n                return !!(this._in(key) in this._area);\\n            },\\n            size: function(){ return this.keys().length; },\\n            each: function(fn, _and) {// _and is purely for internal use (see keys())\\n                for (var i=0, m=_.length(this._area); i<m; i++) {\\n                    var key = this._out(_.key(this._area, i));\\n                    if (key !== undefined) {\\n                        if (fn.call(this, key, _and || this.get(key)) === false) {\\n                            break;\\n                        }\\n                    }\\n                    if (m > _.length(this._area)) { m--; i--; }// in case of removeItem\\n                }\\n                return _and || this;\\n            },\\n            keys: function() {\\n                return this.each(function(k, list){ list.push(k); }, []);\\n            },\\n            get: function(key, alt) {\\n                var s = _.get(this._area, this._in(key));\\n                return s !== null ? _.parse(s) : alt || s;// support alt for easy default mgmt\\n            },\\n            getAll: function() {\\n                return this.each(function(k, all){ all[k] = this.get(k); }, {});\\n            },\\n            transact: function(key, fn, alt) {\\n                var val = this.get(key, alt),\\n                    ret = fn(val);\\n                this.set(key, ret === undefined ? val : ret);\\n                return this;\\n            },\\n            set: function(key, data, overwrite) {\\n                var d = this.get(key);\\n                if (d != null && overwrite === false) {\\n                    return data;\\n                }\\n                return _.set(this._area, this._in(key), _.stringify(data), overwrite) || d;\\n            },\\n            setAll: function(data, overwrite) {\\n                var changed, val;\\n                for (var key in data) {\\n                    val = data[key];\\n                    if (this.set(key, val, overwrite) !== val) {\\n                        changed = true;\\n                    }\\n                }\\n                return changed;\\n            },\\n            remove: function(key) {\\n                var d = this.get(key);\\n                _.remove(this._area, this._in(key));\\n                return d;\\n            },\\n            clear: function() {\\n                if (!this._ns) {\\n                    _.clear(this._area);\\n                } else {\\n                    this.each(function(k){ _.remove(this._area, this._in(k)); }, 1);\\n                }\\n                return this;\\n            },\\n            clearAll: function() {\\n                var area = this._area;\\n                for (var id in _.areas) {\\n                    if (_.areas.hasOwnProperty(id)) {\\n                        this._area = _.areas[id];\\n                        this.clear();\\n                    }\\n                }\\n                this._area = area;\\n                return this;\\n            },\\n\\n            // internal use functions\\n            _in: function(k) {\\n                if (typeof k !== \\\"string\\\"){ k = _.stringify(k); }\\n                return this._ns ? this._ns + k : k;\\n            },\\n            _out: function(k) {\\n                return this._ns ?\\n                    k && k.indexOf(this._ns) === 0 ?\\n                        k.substring(this._ns.length) :\\n                        undefined : // so each() knows to skip it\\n                    k;\\n            }\\n        },// end _.storeAPI\\n        storageAPI: {\\n            length: 0,\\n            has: function(k){ return this.items.hasOwnProperty(k); },\\n            key: function(i) {\\n                var c = 0;\\n                for (var k in this.items){\\n                    if (this.has(k) && i === c++) {\\n                        return k;\\n                    }\\n                }\\n            },\\n            setItem: function(k, v) {\\n                if (!this.has(k)) {\\n                    this.length++;\\n                }\\n                this.items[k] = v;\\n            },\\n            removeItem: function(k) {\\n                if (this.has(k)) {\\n                    delete this.items[k];\\n                    this.length--;\\n                }\\n            },\\n            getItem: function(k){ return this.has(k) ? this.items[k] : null; },\\n            clear: function(){ for (var k in this.items){ this.removeItem(k); } },\\n            toString: function(){ return this.length+' items in '+this.name+'Storage'; }\\n        }// end _.storageAPI\\n    };\\n\\n    var store =\\n        // safely set this up (throws error in IE10/32bit mode for local files)\\n        _.Store(\\\"local\\\", (function(){try{ return localStorage; }catch(e){}})());\\n    store.local = store;// for completeness\\n    store._ = _;// for extenders and debuggers...\\n    // safely setup store.session (throws exception in FF for file:/// urls)\\n    store.area(\\\"session\\\", (function(){try{ return sessionStorage; }catch(e){}})());\\n\\n    if (typeof define === 'function' && define.amd !== undefined) {\\n        define('store2', [], function () {\\n            return store;\\n        });\\n    } else if (typeof module !== 'undefined' && module.exports) {\\n        module.exports = store;\\n    } else {\\n        // expose the primary store fn to the global object and save conflicts\\n        if (window.store){ _.conflict = window.store; }\\n        window.store = store;\\n    }\\n\\n})(this, this.define);\\n\"\n\n/***/ }),\n/* 8 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t__webpack_require__(6)(__webpack_require__(9))\n\n/***/ }),\n/* 9 */\n/***/ (function(module, exports) {\n\n\tmodule.exports = \"/**\\n * Copyright (c) 2013 ESHA Research\\n * Dual licensed under the MIT and GPL licenses:\\n *   http://www.opensource.org/licenses/mit-license.php\\n *   http://www.gnu.org/licenses/gpl.html\\n *\\n * Makes it easy to watch for storage events by enhancing the events and\\n * allowing binding to particular keys and/or namespaces.\\n *\\n * // listen to particular key storage events (yes, this is namespace sensitive)\\n * store.on('foo', function listenToFoo(e){ console.log('foo was changed:', e); });\\n * store.off('foo', listenToFoo);\\n *\\n * // listen to all storage events\\n * store.on(function storageEvent(e){ console.log('web storage:', e); });\\n * store.off(storageEvent);\\n * \\n * Status: ALPHA - useful, if you don't mind incomplete browser support for events\\n */\\n;(function(window, document, _) {\\n    _.fn('on', function(key, fn) {\\n        if (!fn) { fn = key; key = ''; }// shift args when needed\\n        var s = this,\\n            bound,\\n            id = _.id(this._area);\\n        if (window.addEventListener) {\\n            window.addEventListener(\\\"storage\\\", bound = function(e) {\\n                var k = s._out(e.key);\\n                if (k && (!key || k === key)) {// must match key if listener has one\\n                    var eid = _.id(e.storageArea);\\n                    if (!eid || id === eid) {// must match area, if event has a known one\\n                        return fn.call(s, _.event(k, s, e));\\n                    }\\n                }\\n            }, false);\\n        } else {\\n            document.attachEvent(\\\"onstorage\\\", bound = function() {\\n                return fn.call(s, window.event);\\n            });\\n        }\\n        fn['_'+key+'listener'] = bound;\\n        return s;\\n    });\\n    _.fn('off', function(key, fn) {\\n        if (!fn) { fn = key; key = ''; }// shift args when needed\\n        var bound = fn['_'+key+'listener'];\\n        if (window.removeEventListener) {\\n            window.removeEventListener(\\\"storage\\\", bound);\\n        } else {\\n            document.detachEvent(\\\"onstorage\\\", bound);\\n        }\\n        return this;\\n    });\\n    _.event = function(k, s, e) {\\n        var event = {\\n            key: k,\\n            namespace: s.namespace(),\\n            newValue: _.parse(e.newValue),\\n            oldValue: _.parse(e.oldValue),\\n            url: e.url || e.uri,\\n            storageArea: e.storageArea,\\n            source: e.source,\\n            timeStamp: e.timeStamp,\\n            originalEvent: e\\n        };\\n        if (_.cache) {\\n            var min = _.expires(e.newValue || e.oldValue);\\n            if (min) {\\n                event.expires = _.when(min);\\n            }\\n        }\\n        return event;\\n    };\\n    _.id = function(area) {\\n        for (var id in _.areas) {\\n            if (area === _.areas[id]) {\\n                return id;\\n            }\\n        }\\n    };\\n})(window, document, window.store._);\"\n\n/***/ }),\n/* 10 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tvar _ = __webpack_require__( 1 );\n\tvar postal = __webpack_require__( 2 );\n\tvar S = __webpack_require__( 4 );\n\tvar state = S.state;\n\tvar env = S.env;\n\t\n\tvar XWindowClient = function() {\n\t\tpostal.fedx.FederationClient.apply( this, arguments );\n\t};\n\t\n\tXWindowClient.prototype = _.create( postal.fedx.FederationClient.prototype, {\n\t\tconstructor: XWindowClient,\n\t\n\t\ttransportName: \"xwindow\",\n\t\n\t\tshouldProcess: function() {\n\t\t\tvar hasDomainFilters = !!state.config.allowedOrigins.length;\n\t\t\treturn state.config.enabled &&\n\t\t\t\t\t// another frame/window\n\t\t\t\t( ( this.options.origin === \"*\" || ( hasDomainFilters && _.includes( state.config.allowedOrigins, this.options.origin ) || !hasDomainFilters ) ) ||\n\t\t\t\t\t// worker\n\t\t\t\t( this.options.isWorker && _.includes( state.workers, this.target ) ) ||\n\t\t\t\t\t// we are in a worker\n\t\t\t\tenv.isWorker );\n\t\t},\n\t\tsend: function( packingSlip ) {\n\t\t\tif ( this.shouldProcess() ) {\n\t\t\t\tvar msg = postal.fedx.transports.xwindow.wrapForTransport( packingSlip );\n\t\t\t\tthis.target.set( \"message\", msg );\n\t\t\t}\n\t\t}\n\t} );\n\t\n\tmodule.exports = XWindowClient;\n\n\n/***/ })\n/******/ ])\n});\n;"]}